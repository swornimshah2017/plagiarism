define("istats-1",[],function(){var t,e,a={version:"2.0.0"},s=a,c=[],l={},n="",u=!1,f=[],d="sa_labels",p="ckpf_echo_device_id",h=null,g="istats-notrack",m="_istats_"+Math.random(),i={internal:!0,external:!0,download:!0,clickthrough:!0,promoimage:!0},v={type:"",url:""},k=[],_=2e3,w=null,o={ignore:/.+\.(jpe?g|gif|png)$/i,webUrl:/^(\.\.?\/|\/|https?:\/\/|[^\/.:]+([\/.]|$))/i,pseudoProtocol:/^(mailto:|javascript:|about:|view-source:|data:)/i,internalUrl:/^(?:\/\/|https?:\/\/)?(?:[^.]+\.)*((bbc|bbci)(?:\.co\.uk|\.com)|doubleclick\.net)(:|\/|$)/i,storeUrl:/^https?:\/\/.*store\.bbc\.(co\.uk|com).*$/i,downloadUrl:/.+\.(pdf|te?xt|rtf|docx?|xlsx?|pptx?|od[tpsgbf]|mp[234]|m4a|mpeg|exe|dmg|zip|tgz)$/i,relativeUrl:/^(\.\.?\/|\/[^\/]|([^\/.:]+([\/.]|$)))/i,clickThrough:/^#sa-(.*)(?:-sa(.*))$/,hashLabels:/^ct_|ns_(fee|campaign|linkname|mchannel|source)=(.+?)$/,domain:/(bbc(?:\.co\.uk|\.com))(:\d+)?(\/.*)?$/i},b={},y={types:{"trackingfail.istats":!0,"trackingsuccess.istats":!0,"redirect.istats":!0,"cookiecreated.istats":!0}},T={},U=[],C=[],r=function(){var e={};for(var t in y.types)e[t]=[];return e},L=M(d);function x(e){return void 0===e.istats&&(e.istats={}),void 0===e.istats.enabled&&(e.istats.enabled=!0),e}function E(e){return e?x(e).istats:window.istats}function I(e){return e=e.replace(/\+/g,"%20"),decodeURIComponent(e)}function D(e){for(var t={},n=e.split("&"),r=0;r<n.length;r++){var o=n[r].split("=");t[o[0]]=o[1]}return t}function N(e){if(e||(e=location.hash),""!==e){var t,n=e.match(o.clickThrough),r="";if(null===n)return;if(n[2]&&(r="#"+n[2]),function(e){if(history.replaceState){var t=location.protocol+"//"+location.host+(location.pathname?location.pathname:"");try{history.replaceState({},"",t+e)}catch(e){window.console&&console.log&&console.log(e)}}else location.hash=e}(r),""===(t=n[1]))return;return v.type="click through",D(I(t))}}function R(){var e=!0,t=!0,n=E().enabled;return window.bbcFlagpoles_istats&&(t=!("ON"===window.bbcFlagpoles_istats)),!t&&n||(e=!1),e}function S(e){if("string"!=typeof e)throw Error("'site' must be a string");return e=e.toLowerCase().replace(/_/g,"-")}function $(e,t){return!!e.className&&-1!==(" "+e.className+" ").indexOf(" "+t+" ")}function O(e){var t=e.match(o.domain);return t?t[1]:e.replace(/:\d+$/,"")}function j(e,t){t=t||"&";var n=[];for(var r in e.hasOwnProperty("name")&&n.push(encodeURIComponent("name")+"="+encodeURIComponent(e.name)),e)e.hasOwnProperty(r)&&"object"!=typeof e[r]&&("linkLocation"===r?n.push(encodeURIComponent("link_location")+"="+encodeURIComponent(e[r])):"name"!==r&&"ns_referrer"!==r&&n.push(encodeURIComponent(r)+"="+encodeURIComponent(e[r])));return e.hasOwnProperty("ns_referrer")&&n.push(encodeURIComponent("ns_referrer")+"="+encodeURIComponent(e.ns_referrer)),n.join(t)}function F(e){"string"==typeof e&&(e=D(I(e))),K(l,e)}function K(e,t){for(var n in t)e[n]=t[n];return e}function P(e){z("ckpf_sa_labels_persist",e)}function W(){var t={},e=M("ckpf_sa_labels_persist");if(e)try{t=JSON.parse(e)}catch(e){t={}}return t}function A(e,t,n,r,o){e.istats=e.istats||{},e.istats.linkType=t,e.istats.linkTrackerUrl=n,e.istats.linkLocation=r,e.istats.linkElement=o}function H(e){for(var t={};e;){if(e.linktrack){"string"==typeof e.linktrack&&(t=D(I(e.linktrack))),"object"==typeof e.linktrack&&(t=e.linktrack);break}e=e.parentNode}return t}function G(e,t,n,r){var o=r.altKey||r.ctrlKey||r.metaKey||r.shiftKey,i=function(){},a=o||n.target&&!n.target.match(/^_(self|parent|top)$/i);a||(i=function(){!1!==y.notify(t,"redirect.istats",r)&&(window.location.href=n.href)}),clearTimeout(w),w=setTimeout(function(){y.notify(t,"trackingfail.istats",r),i()},_),B(e,function(){clearTimeout(w),!1!==y.notify(t,"trackingsuccess.istats",r)&&i()},r),a||(r.preventDefault?r.preventDefault():event.returnValue=!1)}function J(e){void 0===e[m]&&(e[m]={eventsKey:C.length,linkTypesTracked:{}},C.push(r()))}function z(e,t,n){var r,o=new Date,i=window.location.host;return void 0===n&&(n=31536e6),o.setTime(o.getTime()+n),r=e+"="+t+("; expires="+o.toGMTString())+"; domain="+O(i)+"; path=/",document.cookie=r}function M(e){for(var t,n=e+"=",r=document.cookie.split(";"),o=0,i=r.length;o<i;o++){for(t=r[o];" "===t.charAt(0);)t=t.substring(1,t.length);if(0===t.indexOf(n))return decodeURIComponent(t.substring(n.length,t.length))}return null}function V(e){for(var t in void 0===e&&(e={}),l)void 0===e[t]&&(e[t]=l[t]);var n="unavailable";return window.screen&&screen.width&&screen.height&&(n=screen.width+"x"+screen.height),h&&(e.ns_alias=h),e.screen_resolution=n,e.bbc_site=s.getSite(),e.name=s.getCountername(),e.ns_ti=document.title,e.ns_c=document.characterSet?document.characterSet:document.defaultCharset,e.ns__t=(new Date).getTime(),e.ns_jspageurl=location&&location.href?location.href:document.URL,e.ns_referrer=q(),e}function q(){return encodeURI(window.orb&&window.orb.referrer?window.orb.referrer:document.referrer)}function B(e,t,n,r){if(R())if(u){if(0==c.length)throw Error("No data collectors available");e=V(e),k.push(e);for(var o=0,i=0;i<c.length;i++){collector=c[i],separator=collector.separator||"&";var a=new Image;a.src=collector.url+"?"+j(e,separator),"function"==typeof t&&(a.onload=function(){++o==c.length&&t()})}}else r||U.push({labels:e,callback:t,event:n})}function Q(e){return e.split("?")[0].split("#")[0]}return x(window),L=L||E()._trackingCookie,null!==M(e=d)&&z(e,"",-1),a.getConfig=E,a.isReady=function(e){return"function"==typeof e&&(u?e():f.push(e)),u},a._getLabelsFromString=D,a.isEnabled=R,a.setCountername=function(e){t=e},a.getCountername=function(){return t||(t=window.location.pathname.replace(/\/$/,"").replace(/^\//,"").replace(/\//g,".")+".page"),t.match(/\.page$/)||(t+=".page"),t},a._normaliseLabelValue=S,a.setSite=function(e){n=S(e)},a.getSite=function(){return n||"string"==typeof l.bbc_site&&s.setSite(l.bbc_site),n},a.getDefaultURL=function(){try{var e=s.getCollector("default")}catch(e){return""}return e.url+"?"+j(V({}),"&")},a.track=function(e,t){if(R()){if(!i[e])throw'Given linkType, "'+e+'" is not valid.';(t=t||{}).region||(t.region=[document.body]),void 0===t.region.push&&(t.region=[t.region]);for(var n=t.region.length;n--;){var r=t.region[n];J(r);var o=r[m];o.linkTypesTracked[e]=t||{},o.trackerAttached||(!function(t){b.attach(t,"click",function(e){T.dispatch(t,e)})}(r),o.trackerAttached=!0)}}},a.observe=function(e,t,n){if(!y.types[t])throw'Cannot observe: Given eventType, "'+t+'" in unknown.';void 0===e.push&&(e=[e]);for(var r=e.length;r--;)J(e[r]),C[e[r][m].eventsKey][t].push(n)},a._isInternal=function(e){return a._isWebUrl(e)&&(o.relativeUrl.test(e)||o.internalUrl.test(e))&&!o.storeUrl.test(e)},a._isInternalCrossDomain=function(e){return a._isWebUrl(e)&&s._isInternal(e)&&a._getDomainFromHost(window.location.host)!==a._getDomainFromHost(e)},a._isExternal=function(e){return a._isWebUrl(e)&&!s._isInternal(e)},a._isDownload=function(e){return o.webUrl.test(e)&&o.downloadUrl.test(e)},a._isWebUrl=function(e){return o.webUrl.test(e)&&!o.ignore.test(e)&&!o.pseudoProtocol.test(e)},a._getDomainFromHost=O,a._getLabelsFromHashString=N,a._createCookie=z,a._inspectTracking=function(e){return void 0!==e&&(v=e),v},a.log=function(e,t,n,r){n=n||{},R()&&("pageview"!==e.toLowerCase()&&(n.ns_type="hidden",n.action_name=t,n.action_type=e),v.type="logging actions",B(n,r))},a.addNoTrack=function(e){var t,n,r;n=g,r=(t=e).className?t.className+" ":"",$(t,n)||(t.className=r+n)},a.removeNoTrack=function(e){!function(e,t){for(var n=e.className.split(" "),r=[],o=n.length;o--;)n[o]!==t&&r.unshift(n[o]);e.className=r.length?r.join(" "):""}(e,g)},a.addLabels=F,a._getLabels=function(){return l},a.addStoredLabels=function(e,t){"string"==typeof e&&(e=D(I(e))),F(e);var n=(new Date).getTime()+t,r=W();for(var o in e)r[o]={value:e[o],expires:n};P(JSON.stringify(r))},y.notify=function(e,t,n){for(var r=C[e[m].eventsKey][t],o=0,i=r.length;o<i;o++)if("function"==typeof r[o]&&!1===r[o](n))return!1},b.attach=function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n},b.detach=function(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent?e.detachEvent("on"+t,n):e["on"+t]=null},b.getTarget=function(e){return(e=e||window.event).target||e.srcElement},T.dispatch=function(e,t){var n,r,o,i,a=function(e,t){var n=e;do{if("A"==n.nodeName)return n;if(n===t)return!1}while(n=n.parentNode)}(b.getTarget(t),this);a&&a.href&&(i=(new Date).getTime(),a.istatsTimestamp&&i-a.istatsTimestamp<500||$(a,g)||(n=function(e){if(s._isWebUrl(e))return s._isExternal(e)?"external":s._isDownload(e)?"download":s._isInternal(e)?"internal":void 0}(a.href),r=T[n],o=e[m].linkTypesTracked[n],n&&r&&o&&(a.istatsTimestamp=i,t.istats=t.istats||{},T[n](e,a,t))))},T.external=function(e,t,n){var r=e[m].linkTypesTracked.external||{};r.extlink_url=t.href,r.ns_type="hidden",r.action_type="extlink",r.ns_referrer=q(),t.id&&(r.extlink_id=t.id),K(r,H(t)),r.linkLocation||(r.linkLocation=""),A(n,v.type="external",j(r),r.linkLocation,t),G(r,e,t,n)},T.download=function(e,t,n){var r=e[m].linkTypesTracked.download||{};r.download_url=t.href,r.ns_type="hidden",r.action_type="download",r.ns_referrer=q(),t.id&&(r.download_id=t.id),K(r,H(t)),r.linkLocation||(r.linkLocation=""),A(n,v.type="download",j(r),r.linkLocation,t),G(r,e,t,n)},T.internal=function(e,t,n){var r=e[m].linkTypesTracked.internal||{};if(r.intlink_from_url=location.href,r.intlink_ts=(new Date).getTime(),t.id&&(r.intlink_id=t.id),K(r,H(t)),r.linkLocation||(r.linkLocation=""),a._isInternalCrossDomain(t.href)){var o=t.href.split("#",2),i=o[0]+"#sa-"+j(r)+"-sa";o[1]&&(i+=o[1]),t.href=i}else L=j(r),z(d,L,1e4),y.notify(e,"cookiecreated.istats",n)},a.addCollector=function(e){if("object"!=typeof e)throw new Error("Only an object can be passed in as a collector");if(!e.name)throw new Error("Collector must have a name");if(!e.url)throw new Error("Collector must have a url");return e.seperator&&(e.separator=e.seperator,delete e.seperator),c.push(e),!0},a.getCollector=function(e){for(var t=0;t<c.length;t++)if(c[t].name===e)return c[t];throw Error("Unable to find "+e+" in collectors")},a._sendData=B,a.labelsSent=function(){return k},a.invoke=function(){var e;if(!u&&R()){e=N()||function(){if("string"==typeof L)return v.type="internal",D(decodeURIComponent(L))}(),function(){var e=W(),t={},n=(new Date).getTime();for(var r in e)e[r].expires>n&&(t[r]=e[r]);P(JSON.stringify(t))}();var t=W(),n={};for(var r in t)n[r]=t[r].value;F(n),u=!0;var o=K({},l);if(e&&(function(e){if(!e.intlink_from_url)return!1;var t=q();return!t||Q(e.intlink_from_url)===Q(t)||(s.log("error","istats-internal-link-tracking",e),!1)}(e)||(e.intlink_from_url=void 0,e.intlink_ts=void 0,e.link_location=void 0),o=K(o,e),E()._linkTracked=!0),h=M(p),s.log("pageview",s.getCountername(),o),0<U.length)for(var i in U)B(U[i].labels,U[i].callback,U[i].event,!0);if(f&&0<f.length)for(var a=0;a<f.length;a++)"function"==typeof f[a]&&f[a]();f=[]}},a._partialReset=function(){u=!1,f=[],k=[],h=void 0,l={}},a});